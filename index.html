<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            overscroll-behavior: contain;
        }
    </style>
</head>

<body id="body">
    <audio autoplay loop>
        <source src="sounds/bgmusic.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    <div style="width:100%;">
        <span style="position:absolute; top:10px; left:0px;">
            Score: <input style="border:none;width:50px;" type="text" id="score" disabled="disabled"/>
            Lines: <input style="border:none;width:30px;" type="text" id="lines" disabled="disabled"/>
            Level: <input style="border:none;width:30px;" type="text" id="level" disabled="disabled"/>
            <span id="stats"></span>
        </span>
        <span style="position:absolute; top:40px; left:210px;">
            <fieldset>
                <legend>Next</legend>
                <img id="next" />
            </fieldset>
        </span>
        <span style="position:absolute; top:50px; left:0px;">
            <canvas id="jetris" width="204" height="404"></canvas>
            <div>
                <button title="New Game" onclick="newGame(this)">
                    <span class="material-symbols-outlined">
                        videogame_asset
                    </span>
                </button>
                <button title="Play/Pause" onclick="pause(this)">
                    <span id="pause_icon" class="material-symbols-outlined">
                        pause
                    </span>
                </button>
                <button title="Mute" onclick="mute(this);">
                    <span id="mute_icon" class="material-symbols-outlined">
                    volume_up
                    </span>
                </button>
            </div>
        </span>
    </div>
    <script src="jetris.js"></script>
    <script>
        // interface specific JS code
        let statsHTML = "";
        for (let i = 0; i < piecesFiles.length; ++i) {
            statsHTML = statsHTML +
                `<img style="position:absolute; top:${150 + i * 25}px; left:210px;" width="30" height="20" src="` + piecesImages[i].src +
                `"><input style="border:none;width:50px;position:absolute;top:${150 + i * 25}px;left:250px;" disabled=disabled type=text id="piece` + i + '">';
        }
        statsHTML = statsHTML + `<input style="border:none;width:50px;position:absolute;top:${150 + piecesFiles.length * 25}px;left:250px;" disabled=disabled type=text id="count">`;

        const values = ['', 'I', 'II', 'III', 'IV'];
        for (let i = 1; i < 5; ++i) {
            statsHTML = statsHTML +
                `<input disabled=disabled value=${values[i]} style="position:absolute;width:30px;border:none;top:${150 + (i+piecesFiles.length) * 25}px; left:210px;" size="1"/><input style="border:none;width:30px;position:absolute;top:${150 + (i+piecesFiles.length) * 25}px;left:250px;" disabled=disabled type=text id="score` + i + '">';
        }

        document.getElementById("stats").innerHTML = statsHTML;

        let game;
        let muted = false;

        function newGame(newGameButton) {
            if (window.confirm('New Game?')) {
                resetGame(); 
            }
            newGameButton.blur();
        }

        function pause(pauseButton) {
            if (game) {
                if (game.pause()) {
                    pauseButton.style = "border-style:inset;";
                    document.getElementById("pause_icon").innerHTML = "play_arrow";
                } else {
                    pauseButton.style = "";
                    document.getElementById("pause_icon").innerHTML = "pause";
                }
            }
            pauseButton.blur();
        }

        function mute(muteButton) {
            if ((game && game.mute()) || !muted) {
                muteButton.style = "border-style:inset;";
                document.getElementById("mute_icon").innerHTML = "volume_off";
            } else {
                muteButton.style = "";
                document.getElementById("mute_icon").innerHTML = "volume_up";
            }
            muted = !muted;
            muteButton.blur();
        }

        function resetGame() {
            if (game)
                game.stop();

            game = new JetrisGame(
                document.getElementById("jetris"),
                rect.width,
                piecesImages,
                bgImage,
                sounds,
                muted,
                25, 
                (game) => {
                    document.getElementById("score").value = game.score;
                    document.getElementById("lines").value = game.rowCount;
                    document.getElementById("level").value = game.level;
                    document.getElementById("next").src = piecesFiles[game.nextPieceIndex];
                    for (let i = 1; i < 5; ++i) {
                        document.getElementById("score" + i).value = game.comboRowCount[i];
                    }
                    const totalPieces = game.pieceCount.reduce((a, b) => a + b, 0);
                    document.getElementById("count").value = '#' + totalPieces;
                    if (totalPieces > 0) {
                        for (let i = 0; i < game.pieceCount.length; ++i) {
                            document.getElementById("piece" + i).value = (100 * (game.pieceCount[i] / totalPieces)).toFixed(2) + '%';
                        }
                    }
                }
            );

            game.playSound(JetrisGame.Sounds.START);
            game.run();
        }

        splash = new Image();
        splash.onload = () => {
            document.getElementById("jetris").getContext("2d").drawImage(splash, 0, 0);
        };
        splash.src = "data:image/png;base64, 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";
    </script>
</body>

</html>
